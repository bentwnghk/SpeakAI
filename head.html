<!-- Primary Meta Tags -->
<title>Mr.ðŸ†– PodcastAI - Convert Documents and Websites into Audio Podcasts</title>
<meta name="title" content="Mr.ðŸ†– PodcastAI - Convert Documents and Websites into Audio Podcasts" />
<meta
  name="description"
  content="Easily convert documents amd websites into audio podcasts. Perfect for listening on the go and making content more accessible."
/>
<!-- Additional Meta Tags -->
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta charset="UTF-8" />
<meta name="author" content="Mr.ðŸ†– AI" />
<meta
  name="keywords"
  content="document to podcast, website to podcast, audio conversion, podcast creation, accessible content"
/>
<link rel="icon" href="/static/icon.png" type="image/png" />

<script>
  // Global Error Handler
  window.onerror = function(message, source, lineno, colno, error) {
    console.error("[GLOBAL_ERROR] Uncaught Exception:", {
      message: message,
      source: source,
      lineno: lineno,
      colno: colno,
      error: error ? error.stack : 'No error object'
    });
    return true; // Prevents default browser error handling
  };

  console.log("[HEAD_SCRIPT] Initializing script. Global error handler set.");

  const PODCAST_HISTORY_KEY = 'gradioPdfToPodcastHistory';
  console.log("[HEAD_SCRIPT] PODCAST_HISTORY_KEY set.");

  function getPodcastHistory() {
    // console.log("[GET_HISTORY] Attempting to get history from localStorage.");
    try {
        const history = localStorage.getItem(PODCAST_HISTORY_KEY);
        // console.log("[GET_HISTORY] Raw history from localStorage:", history);
        return history ? JSON.parse(history) : [];
    } catch (e) {
        console.error("[GET_HISTORY] Error reading podcast history from localStorage:", e);
        return [];
    }
  }

  function savePodcastHistory(history) {
    // console.log("[SAVE_HISTORY] Attempting to save history to localStorage:", history);
    try {
        localStorage.setItem(PODCAST_HISTORY_KEY, JSON.stringify(history));
        // console.log("[SAVE_HISTORY] History saved successfully.");
    } catch (e) {
        console.error("[SAVE_HISTORY] Error saving podcast history to localStorage:", e);
        alert("Could not save podcast history. Storage might be full.");
    }
  }

  function renderPodcastHistory() {
    console.log("[RENDER_HISTORY] Attempting to render podcast history.");
    const listContainer = document.getElementById('podcastHistoryList');
    if (!listContainer) {
        console.warn("[RENDER_HISTORY] Podcast history list container ('podcastHistoryList') not found in DOM yet.");
        return;
    }
    console.log("[RENDER_HISTORY] List container found. Clearing and populating.");
    listContainer.innerHTML = ''; // Clear existing items
    const history = getPodcastHistory();
    console.log(`[RENDER_HISTORY] Found ${history.length} items in history.`);

    if (history.length === 0) {
        const emptyMsg = document.createElement('li');
        emptyMsg.textContent = 'No podcasts in history.';
        emptyMsg.style.padding = '10px';
        emptyMsg.style.textAlign = 'center';
        listContainer.appendChild(emptyMsg);
        console.log("[RENDER_HISTORY] Displayed 'No podcasts in history.'");
        return;
    }

    history.forEach(podcast => {
        const item = document.createElement('li');
        item.style.marginBottom = '10px';
        item.style.padding = '10px';
        item.style.border = '1px solid #e0e0e0';
        item.style.borderRadius = '4px';
        item.style.display = 'flex';
        item.style.flexDirection = 'column';

        const titleSpan = document.createElement('span');
        titleSpan.textContent = `${podcast.title}`;
        titleSpan.style.fontWeight = 'bold';
        titleSpan.style.marginBottom = '5px';

        const dateSpan = document.createElement('span');
        dateSpan.textContent = `Saved: ${new Date(podcast.savedAt).toLocaleString()}`;
        dateSpan.style.fontSize = '0.9em';
        dateSpan.style.color = '#666';
        dateSpan.style.marginBottom = '8px';
        
        const buttonContainer = document.createElement('div');

        const loadButton = document.createElement('button');
        loadButton.textContent = 'Load';
        loadButton.className = 'gr-button gr-button-sm gr-button-secondary';
        loadButton.onclick = () => {
            console.log(`[RENDER_HISTORY] Load button clicked for podcast ID: ${podcast.id}`);
            // loadPodcastFromHistory(podcast.id); // Temporarily disabled
        };
        loadButton.style.marginRight = '5px';
        
        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.className = 'gr-button gr-button-sm gr-button-stop';
        deleteButton.onclick = () => {
            console.log(`[RENDER_HISTORY] Delete button clicked for podcast ID: ${podcast.id}`);
            // deletePodcastFromHistory(podcast.id); // Temporarily disabled
        };

        item.appendChild(titleSpan);
        item.appendChild(dateSpan);
        buttonContainer.appendChild(loadButton);
        buttonContainer.appendChild(deleteButton);
        item.appendChild(buttonContainer);
        listContainer.appendChild(item);
    });
    console.log("[RENDER_HISTORY] Finished rendering history items.");
  }

  function initializePodcastHistoryFeature() {
    let attempts = 0;
    const maxAttempts = 60; // 6 seconds
    console.log("[INIT_HISTORY_FEATURE] Initializing. Waiting for list container...");
    const interval = setInterval(() => {
        const listContainer = document.getElementById('podcastHistoryList');
        if (listContainer) {
            clearInterval(interval);
            console.log("[INIT_HISTORY_FEATURE] Podcast history list container found. Rendering history.");
            renderPodcastHistory();
        } else {
            attempts++;
            if (attempts % 10 === 0) {
                 console.log(`[INIT_HISTORY_FEATURE] Waiting for list container... attempt ${attempts}`);
            }
            if (attempts >= maxAttempts) {
                clearInterval(interval);
                console.warn("[INIT_HISTORY_FEATURE] Podcast history list container ('podcastHistoryList') NOT FOUND after multiple attempts.");
            }
        }
    }, 100);
  }

  // Wait for Gradio to be ready or use DOMContentLoaded
  document.addEventListener('DOMContentLoaded', () => {
    console.log("[DOM_CONTENT_LOADED] DOM fully loaded and parsed. Initializing history feature.");
    initializePodcastHistoryFeature();

    // Additional call to render history after a short delay, as a fallback
    setTimeout(() => {
        console.log("[DOM_CONTENT_LOADED] Delayed attempt to render history (2s).");
        renderPodcastHistory();
    }, 2000);
  });

  console.log("[HEAD_SCRIPT] Script basic structure loaded. DOMContentLoaded listener set.");

</script>
